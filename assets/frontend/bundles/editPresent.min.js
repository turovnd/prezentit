var editPresent=function(e){function t(n){if(s[n])return s[n].exports;var a=s[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var s={};return t.m=e,t.c=s,t.i=function(e){return e},t.d=function(e,s,n){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=17)}({14:function(e,t){},17:function(e,t,s){s(14),e.exports=function(e){return e.plagin=s(6),e}({})},6:function(e,t){e.exports=function(e){function t(){return z=document.getElementById("PresentName"),W=document.getElementById("editPresentNameBtn"),X=document.getElementById("editPresentNameFrom"),Y=document.getElementById("editPresentNameInput"),!(!(G=document.getElementById("editPresentNameBtnSubmit"))||!W)&&(G.addEventListener("click",x),W.addEventListener("click",A),!0)}function s(){var e=document.getElementsByClassName("js-new-slide");if(0===e.length)return!1;for(var t=0;t<e.length;t++)e[t].addEventListener("click",o);return!0}function n(){q=document.getElementsByClassName("presentation")[0],U=document.getElementById("presentation_id").value;var e=document.getElementsByClassName("presentation__slide");0===e.length&&l();for(var t=0;t<e.length;t++)e[t].classList.remove("presentation__slide--after","presentation__slide--before");return C(),window.addEventListener("resize",C),!0}function a(){Z=document.getElementsByClassName("aside__menu")[0],se=JSON.parse(document.getElementById("slides_order").value);var e=window.location.pathname.split("/")[3],t=document.getElementsByClassName("js-select-slide"),s=document.getElementsByClassName("js-delete-slide"),n=!1;pit.cookies.get("cur_slide")&&pit.cookies.get("cur_slide").match(new RegExp(e))&&(ne=parseInt(pit.cookies.get("cur_slide").replace(window.location.pathname.split("/")[3],"")));for(var a=0;a<t.length;a++)t[a].addEventListener("click",p),s[a].addEventListener("click",f),t[a].parentNode.id==="aside_"+ne&&(n=!0);return t.length>0&&(n||(ne=t[0].parentNode.id.split("_")[1],pit.cookies.set({name:"cur_slide",value:"presentation~"+window.location.pathname.split("/")[3]+ne,expires:21600,path:"/"})),_(ne)),!0}function i(){ae=document.getElementsByClassName("config__status")[0],$=document.getElementById("configContent"),ie=document.getElementsByClassName("js-ajax-edited");for(var e=0;e<ie.length;e++)ie[e].addEventListener("keyup",b);for(var t=document.getElementsByClassName("bg-image"),e=0;e<t.length;e++)t[e].classList.contains("bg-image--with-image")?t[e].addEventListener("click",S):t[e].addEventListener("click",I);for(var s=document.getElementsByClassName("checkbox"),e=0;e<s.length;e++)s[e].addEventListener("click",k);return!0}function r(){re=[];for(var e=document.getElementsByClassName("answer"),t=null,s=null,n=null,a=0;a<e.length;a++){t=[],e[a].dataset.answer=a,n=e[a].getElementsByClassName("answer__item");for(var i=0;i<n.length;i++){n[i].getElementsByClassName("js-option-delete")[0].addEventListener("click",O),n[i].getElementsByClassName("js-option-delete")[0].dataset.number=i;var r=n[i].getElementsByClassName("answer__value")[0],l=n[i].getElementsByClassName("answer__image")[0];s={text:r.value,image:l&&""!==l.getElementsByClassName("bg-image__image")[0].dataset.src?l.getElementsByClassName("bg-image__image")[0].dataset.src:""},r.addEventListener("keyup",P),r.dataset.number=i,l&&(""===l.getElementsByClassName("bg-image__image")[0].dataset.src?l.addEventListener("click",J):l.addEventListener("click",M),l.dataset.number=i),l=r=null,t.push(s)}re.push(t)}for(var o=document.getElementsByClassName("answers-with-image"),d=document.getElementsByClassName("js-option-add"),a=0;a<o.length;a++)o[a].addEventListener("click",H);for(var a=0;a<d.length;a++)d[a].addEventListener("click",T);return!0}function l(){var e=pit.draw.node("SECTION","cursor-pointer presentation__slide presentation__slide--items-center presentation__slide--active",{id:"defaultSlide"});e.innerHTML='<div class="presentation__content presentation__content--center"><h1 class="presentation__content-heading presentation__text--light"> Создать новый слайд </h1></div>',e.addEventListener("click",o),document.getElementsByClassName("presentation__slides")[0].appendChild(e)}function o(){K=pit.notification.notify({type:"confirm",size:"large",message:'<div class="new-slide"><h2 class="new-slide__title">Новый слайд</h2><div class="new-slide__wrapper">'+d()+"</div></div>",showCancelButton:!0,confirmText:"Создать",cancelText:"Закрыть",validation:!0,confirm:u,cancel:g}),Q=document.getElementsByClassName("new-slide__content");for(var e=document.getElementsByClassName("new-slide__close-icon"),t=0;t<Q.length;t++)Q[t].addEventListener("click",c),e[t].addEventListener("click",m)}function d(){for(var e,t="",s=0;s<le.length;s++){if(e="",t+='<div class="new-slide__block" data-type="'+le[s].type+'"><i class="fa fa-close new-slide__close-icon" aria-hidden="true"></i><div class="new-slide__content"><p class="new-slide__name">'+le[s].name+'</p><img class="new-slide__image" src="/assets/static/img/slides/types/'+le[s].image+'"><i class="fa '+le[s].icon+' new-slide__icon" aria-hidden="true"></i></div>',void 0!==le[s].options){e+='<div class="new-slide__options-wrapper">';for(var n=0;n<le[s].options.length;n++)e+='<div class="new-slide__option"><input type="'+le[s].options[n].type+'" id="'+le[s].options[n].id+'" name="'+le[s].options[n].name+'" data-name="'+le[s].options[n].data_name+'" data-value="'+le[s].options[n].data_value+'" class="checkbox"><label for="'+le[s].options[n].id+'" class="checkbox-label">'+le[s].options[n].title+"</label></div>";e+="</div>"}t+=e+"</div>"}return t}function c(){V=this;for(var e=0;e<Q.length;e++)Q[e].parentNode.classList.add("hide");V.parentNode.classList.remove("hide"),V.removeEventListener("click",c),V.parentNode.classList.add("new-slide__block--selected")}function m(){V.addEventListener("click",c),V.parentNode.classList.remove("new-slide__block--selected"),V=null;for(var e=0;e<Q.length;e++)Q[e].parentNode.classList.remove("hide")}function g(){for(var e=0;e<Q.length;e++)Q[e].removeEventListener("click",c);Q=null}function u(){if(null===V)return pit.notification.notify({message:"Пожалуйста выберите тип слайда",type:"error"}),pit.core.log("New slide type has not chosen","error",R),!1;var e=document.getElementsByClassName("new-slide")[0];e.classList.add("loading");var t=new FormData,s=V.parentNode.dataset.type,n=V.nextSibling,a=null;if(V=null,t.append("type",s),t.append("presentation",U),n)for(var i=0;i<n.childElementCount;i++)(a=n.children[i].querySelector("input:checked"))&&t.append(a.dataset.name,a.dataset.value);var r={url:"/slide/add",type:"POST",data:t,success:function(t){if(t=JSON.parse(t),pit.notification.notify({type:t.status,message:t.message}),e.classList.remove("loading"),70!==parseInt(t.code))return pit.core.log(t.message,"error",R),!1;y(t.aside,t.slideId),E(t.config,t.slideId),L(t.slide,t.slideId),B("add",t.slideId),_(t.slideId),pit.core.log("New slide with type="+s+" has been created","",R),K.close(),K=null},error:function(t){return pit.core.log("ajax error occur on sending new slide data","error",R,t),e.classList.remove("loading"),!1}};pit.ajax.send(r)}function p(){ne=this.parentNode.id.split("_")[1],_(ne)}function _(e){document.getElementsByClassName("aside__item--active")[0]&&document.getElementsByClassName("aside__item--active")[0].classList.remove("aside__item--active"),document.getElementsByClassName("config__item--active")[0]&&document.getElementsByClassName("config__item--active")[0].classList.remove("config__item--active"),document.getElementsByClassName("presentation__slide--active")[0]&&(document.getElementsByClassName("presentation__slide--active")[0].classList.add("presentation__slide--inactive"),document.getElementsByClassName("presentation__slide--active")[0].classList.remove("presentation__slide--active")),document.getElementById("aside_"+e).classList.add("aside__item--active"),document.getElementById("config_"+e).classList.add("config__item--active"),document.getElementById("slide_"+e).classList.remove("presentation__slide--inactive"),document.getElementById("slide_"+e).classList.add("presentation__slide--active"),pit.cookies.set({name:"cur_slide",value:"presentation~"+window.location.pathname.split("/")[3]+e,expires:21600,path:"/"})}function f(){ee=pit.notification.notify({type:"confirm",message:'<div class="delete-slide"><h2 class="">Удаление слайда</h2><p>Вы уверены что хотите удалить? Удалив слайд у Вас не будет возможности его восстановить.</p></div>',showCancelButton:!0,confirmText:"Удалить",cancelText:"Закрыть",validation:!0,confirm:v}),te=this.id.split("_")[1]}function v(){var e=new FormData,t=document.getElementsByClassName("delete-slide")[0];e.append("id",te),e.append("presentation",U);var s={url:"/slide/delete",type:"POST",data:e,beforeSend:function(){t.classList.add("loading")},success:function(e){if(e=JSON.parse(e),pit.notification.notify({type:e.status,message:e.message}),t.classList.remove("loading"),73!==parseInt(e.code))return pit.core.log(e.message,"error",R),!1;h(te),w(te),document.getElementById("slide_"+te).remove(),0===document.getElementsByClassName("presentation__slide").length&&l(),B("remove",te),pit.core.log("Slide with id="+te+" has been deleted","",R),ee.close(),te=null,ee=null},error:function(e){return pit.core.log("ajax error occur on deleting slide","error",R,e),t.classList.remove("loading"),!1}};pit.ajax.send(s)}function y(e,t){var s=pit.draw.node("A","aside__item",{id:"aside_"+t,role:"button"});s.innerHTML='<span class="aside__item-number">'+parseInt(document.getElementsByClassName("js-select-slide").length+1)+'</span><span class="aside__item-action"><i id="delete_'+t+'" class="fa fa-trash aside__item-action-icon text-danger js-delete-slide" aria-hidden="true"></i></span>'+e,Z.appendChild(s),document.getElementById("aside_"+t).getElementsByClassName("js-select-slide")[0].addEventListener("click",p),document.getElementById("delete_"+t).addEventListener("click",f)}function h(e){document.getElementById("aside_"+e).getElementsByClassName("js-select-slide")[0].removeEventListener("click",p),document.getElementById("delete_"+e).removeEventListener("click",f);var t=null;document.getElementById("aside_"+e).classList.contains("aside__item--active")&&se.length>1&&(t=0===se.indexOf(e)?se[1]:se[se.indexOf(e)-1],_(t)),document.getElementById("aside_"+e).remove(),N()}function E(e,t){var s=pit.draw.node("LI","config__item",{id:"config_"+t});s.innerHTML=e,$.appendChild(s);for(var n=s.getElementsByClassName("js-ajax-edited"),a=s.getElementsByClassName("bg-image"),i=s.getElementsByClassName("checkbox"),r=s.getElementsByClassName("answer")[0],l=0;l<n.length;l++)n[l].addEventListener("keyup",b);for(var l=0;l<a.length;l++)a[l].addEventListener("click",I);for(var l=0;l<i.length;l++)i[l].addEventListener("click",k);if(r){r.dataset.answer=re.length;for(var o=r.getElementsByClassName("answer__item"),d=[],c=0;c<o.length;c++){o[c].getElementsByClassName("js-option-delete")[0].addEventListener("click",O),o[c].getElementsByClassName("js-option-delete")[0].dataset.number=c;var m=o[c].getElementsByClassName("answer__value")[0],g=o[c].getElementsByClassName("answer__image")[0];r={text:"",image:""},m.addEventListener("keyup",P),m.dataset.number=c,g&&(g.addEventListener("click",J),g.dataset.number=c),g=m=null,d.push(r)}re.push(d)}s=null,n=null,a=null,i=null,r=null}function w(e){for(var t=document.getElementById("config_"+e).getElementsByClassName("js-ajax-edited"),s=document.getElementById("config_"+e).getElementsByClassName("bg-image"),n=document.getElementById("config_"+e).getElementsByClassName("checkbox"),a=0;a<t.length;a++)t[a].removeEventListener("keyup",b);for(var a=0;a<s.length;a++)s[a].removeEventListener("click",I);for(var a=0;a<n.length;a++)n[a].removeEventListener("click",k);t=null,s=null,n=null,document.getElementById("config_"+e).remove()}function L(e,t){var s=pit.draw.node("SECTION","presentation__slide",{id:"slide_"+t}),n=document.getElementsByClassName("presentation__slides")[0],a=document.getElementById("defaultSlide");a&&(a.removeEventListener("click",l),a.remove()),s.innerHTML=e,n.appendChild(s)}function N(){for(var e=document.getElementsByClassName("aside__item-number"),t=0;t<e.length;t++)e[t].textContent=parseInt(t+1)}function B(e,t,s){switch(e){case"add":se.push(parseInt(t));break;case"remove":var n=0;n=se.indexOf(parseInt(t)),se.splice(n,1)}var a=new FormData;a.append("presentation",U),a.append("order",JSON.stringify(se));var i={url:"/slide/update/order",type:"POST",data:a,success:function(e){if(e=JSON.parse(e),74!==parseInt(e.code))return pit.core.log(e.message,"error",R),!1},error:function(e){return pit.core.log("ajax error occur on deleting slide","error",R,e),!1}};pit.ajax.send(i)}function C(){var e=window.innerWidth,t=(window.innerHeight,e>768?220:40),s=e>768?(e-590)/e:(e-80)/e;q.style.height=e<768?3*(e-80)/4+"px":"",q.style.transform="scale("+s+") translateY("+77/s+"px) translateX("+t/s+"px)"}function b(e){1!==e.nodeType&&(e=this);var t=new FormData,s=e.dataset.name,n=e.value,a=e.closest(".config__item").id.split("_")[1];"heading"===s&&(document.getElementById("aside_"+a).getElementsByClassName("aside__item-name")[0].textContent=""!==n?n:e.placeholder),t.append("id",a),t.append("name",s),t.append("value",n);var i={url:"/slide/update/field",type:"POST",data:t,beforeSend:function(){ae.classList.remove("config__status--error"),ae.classList.add("config__status--updating")},success:function(e){if(e=JSON.parse(e),ae.classList.remove("config__status--updating"),76!==parseInt(e.code))return pit.notification.notify({type:"warning",message:e.message}),pit.core.log(e.message,"warning",R),ae.classList.add("config__status--error"),!1;document.getElementById("slide_"+a).innerHTML=e.slide},error:function(e){return pit.core.log("ajax error occur on updating field of slide content","error",R,e),ae.classList.remove("config__status--updating"),ae.classList.add("config__status--error"),!1}};pit.ajax.send(i)}function k(){this.checked?this.value=this.dataset.value:this.value=0,b(this)}function j(){z.classList.toggle("hide"),W.classList.toggle("hide"),X.classList.toggle("hide")}function x(){j();var e=new FormData;e.append("id",U),e.append("name",Y.value);var t={url:"/presentation/editname",type:"POST",data:e,beforeSend:function(){ae.classList.remove("config__status--error"),ae.classList.add("config__status--updating")},success:function(e){if(e=JSON.parse(e),ae.classList.remove("config__status--updating"),54!==parseInt(e.code))return pit.notification.notify({type:e.type,message:e.message}),pit.core.log(e.message,e.type,R),ae.classList.add("config__status--error"),!1;z.innerHTML=Y.value,document.getElementsByTagName("title")[0].innerHTML=Y.value+" | Prezentit"},error:function(e){return pit.core.log("ajax error occur on updating presentation name","error",R,e),ae.classList.remove("config__status--updating"),ae.classList.add("config__status--error"),!1}};pit.ajax.send(t)}function I(){var e=(this.closest(".config__item").id.split("_")[1],this),t=this.getElementsByClassName("bg-image__image")[0];pit.transport.init({url:"/transport/1",beforeSend:function(){var s=new FileReader,n=pit.transport.getInput(),a=n.files[0];s.readAsDataURL(a),e.classList.add("bg-image--with-image"),ae.classList.remove("config__status--error"),ae.classList.add("config__status--updating"),s.onload=function(e){t.classList.add("bg-image--loading"),t.src=e.target.result}},success:function(s){if(s=JSON.parse(s),ae.classList.remove("config__status--updating"),pit.notification.notify({type:s.status,message:s.message}),88!==parseInt(s.code))return e.classList.remove("bg-image--with-image"),ae.classList.add("config__status--error"),!1;t.src=s.icon_url,t.classList.remove("bg-image--loading"),e.removeEventListener("click",I),e.addEventListener("click",S),e.value=s.name,b(e)},error:function(e){return pit.core.log("ajax error occur on updating background","error",R,e),ae.classList.remove("config__status--updating"),ae.classList.add("config__status--error"),!1}})}function S(){var e=this,t=this.getElementsByClassName("bg-image__image")[0];e.classList.remove("bg-image--with-image"),e.removeEventListener("click",S),e.addEventListener("click",I),e.value="",t.src="/",b(e)}function O(){var e=this.closest(".answer"),t=parseInt(this.dataset.number);if(re[e.dataset.answer].length<=2)return pit.notification.notify({type:"warning",message:"Минимальное количество ответов - 2"}),!1;"true"===e.dataset.image&&this.removeEventListener("click",J),e.getElementsByTagName("input")[t].removeEventListener("keyup",P),e.getElementsByClassName("js-option-delete")[t].removeEventListener("click",O);for(var s=t+1;s<re[e.dataset.answer].length;s++)for(var n=e.querySelectorAll('[data-number="'+s+'"]'),a=0;a<n.length;a++)n[a].dataset.number=s-1;re[e.dataset.answer].splice(t,1),e.querySelector(".answer__item:nth-child("+(t+1)+")").remove(),e.getElementsByClassName("js-answers-json")[0].value=JSON.stringify(re[e.dataset.answer]),b(e.getElementsByClassName("js-answers-json")[0])}function T(){var e=this.closest(".answer");if(re[e.dataset.answer].length>=8)return pit.notification.notify({type:"warning",message:"Макисмальное количество ответов - 8"}),!1;var t=pit.draw.node("LI","form-group__control-group answer__item");t.innerHTML='<input type="text" class="form-group__control form-group__control-group-input answer__value input-with-counter" maxlength="60" data-number="'+re[e.dataset.answer].length+'">',"true"===e.dataset.image&&(t.innerHTML+='<a class="form-group__control-group-addon b-l-0 answer__image " title="Картинка ответа" data-number="'+re[e.dataset.answer].length+'"><i class="fa fa-image bg-image__icon" aria-hidden="true"></i><i class="fa fa-close bg-image__close" aria-hidden="true"></i><img src="/" class="bg-image__image" data-src=""></a>'),t.innerHTML+='<a class="form-group__control-group-addon js-option-delete" data-number="'+re[e.dataset.answer].length+'"><i class="fa fa-trash" aria-hidden="true"></i></a>',"true"===e.dataset.image&&t.getElementsByClassName("answer__image")[0].addEventListener("click",J),t.getElementsByTagName("input")[0].addEventListener("keyup",P),pit.form.createCounter(t.getElementsByTagName("input")[0],60),t.getElementsByClassName("js-option-delete")[0].addEventListener("click",O),e.getElementsByClassName("answer__list")[0].appendChild(t),re[e.dataset.answer].push({text:"",image:""}),e.getElementsByClassName("js-answers-json")[0].value=JSON.stringify(re[e.dataset.answer]),b(e.getElementsByClassName("js-answers-json")[0])}function J(){var e=this.closest(".answer"),t=this.dataset.number,s=this,n=this.getElementsByClassName("bg-image__image")[0];pit.transport.init({url:"/transport/2",beforeSend:function(){var e=new FileReader,t=pit.transport.getInput(),a=t.files[0];e.readAsDataURL(a),s.classList.add("bg-image--with-image"),ae.classList.remove("config__status--error"),ae.classList.add("config__status--updating"),e.onload=function(e){n.classList.add("bg-image--loading"),n.src=e.target.result}},success:function(a){if(a=JSON.parse(a),ae.classList.remove("config__status--updating"),pit.notification.notify({type:a.status,message:a.message}),88!==parseInt(a.code))return s.classList.remove("bg-image--with-image"),ae.classList.add("config__status--error"),!1;n.src=a.icon_url,n.classList.remove("bg-image--loading"),s.removeEventListener("click",J),s.addEventListener("click",M),re[e.dataset.answer][t].image=a.name,e.getElementsByClassName("js-answers-json")[0].value=JSON.stringify(re[e.dataset.answer]),b(e.getElementsByClassName("js-answers-json")[0])},error:function(e){return pit.core.log("ajax error occur on updating answer image","error",R,e),ae.classList.remove("config__status--updating"),ae.classList.add("config__status--error"),!1}})}function M(){var e=this.closest(".answer"),t=this,s=this.dataset.number;t.classList.remove("bg-image--with-image"),t.removeEventListener("click",M),t.addEventListener("click",J),re[e.dataset.answer][s].image="",e.getElementsByClassName("js-answers-json")[0].value=JSON.stringify(re[e.dataset.answer]),b(e.getElementsByClassName("js-answers-json")[0])}function P(){var e=this.closest(".answer"),t=this.dataset.number;re[e.dataset.answer][t].text=this.value,e.getElementsByClassName("js-answers-json")[0].value=JSON.stringify(re[e.dataset.answer]),b(e.getElementsByClassName("js-answers-json")[0])}function H(){this.checked?F(this.closest(".config__item").getElementsByClassName("answer__item")):D(this.closest(".config__item").getElementsByClassName("answer__item"))}function F(e){e[0].closest(".answer").dataset.image=!0;for(var t=null,s=0;s<e.length;s++)t=pit.draw.node("A","form-group__control-group-addon b-l-0 answer__image ",{title:"Картинка ответа","data-number":s}),t.innerHTML='<i class="fa fa-image bg-image__icon" aria-hidden="true"></i><i class="fa fa-close bg-image__close" aria-hidden="true"></i><img src="/" class="bg-image__image" data-src="">',pit.core.insertBefore(e[s].getElementsByClassName("js-option-delete")[0],t),t.addEventListener("click",J),t=null}function D(e){e[0].closest(".answer").dataset.image=!1;for(var t=e[0].closest(".answer"),s=0;s<re[t.dataset.answer].length;s++)e[s].getElementsByClassName("answer__image")[0].removeEventListener("click",J),e[s].getElementsByClassName("bg-image__image")[0].dataset.src="",e[s].getElementsByClassName("answer__image")[0].remove(),re[t.dataset.answer][s].image="";t.getElementsByClassName("js-answers-json")[0].value=JSON.stringify(re[t.dataset.answer]),b(t.getElementsByClassName("js-answers-json")[0])}function A(){j(),Y.value=z.innerHTML,Y.focus()}var R="edit-presentation",q=null,z=null,U=null,W=null,X=null,Y=null,G=null,K=null,Q=null,V=null,Z=null,$=null,ee=null,te=null,se=null,ne=null,ae=null,ie=null,re=null;const le=[{type:1,name:"Заголовок",icon:"fa-header",image:"heading_ru.png"},{type:2,name:"Изображение",icon:"fa-image",image:"image_ru.png",options:[{id:"image_position_center",type:"radio",name:"2_image_position",data_name:"image_position",data_value:"1",title:"Изображение по центру слайда"},{id:"image_position_full",type:"radio",name:"2_image_position",data_name:"image_position",data_value:"2",title:"Изображение на весь слайд"}]},{type:3,name:"Параграф",icon:"fa-paragraph",image:"paragraph_ru.png"},{type:4,name:"Слайд с вопросом",icon:"fa-bar-chart",image:"choices_ru.png",options:[{id:"4_answer_with_image",type:"checkbox",name:"4_answers_with_image",data_name:"answers_with_image",data_value:"1",title:"Ответы с изображением"},{id:"4_results_in_percents",type:"checkbox",name:"4_results_in_percents",data_name:"results_in_percents",data_value:"1",title:"Выводить результаты в процентах"}]}];return e.init=function(){t()===s()===n()===a()===i()===r()?pit.core.log("Module loaded","log",R):pit.core.log("Module has not loaded","error",R)},e}({})}});